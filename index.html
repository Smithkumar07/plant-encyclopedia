<?php
session_start();
include 'db.php';

if (!isset($_SESSION['user'])) {
    header("Location: login.php");
    exit();
}

$user_id = $_SESSION['user_id'] ?? 0; 
$message = '';

// Handle Add Plant form submission
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    if(isset($_POST['add_plant'])) {
        $common_name = $conn->real_escape_string($_POST['common_name']);
        $scientific_name = $conn->real_escape_string($_POST['scientific_name']);
        $description = $conn->real_escape_string($_POST['description']);
        $image_url = $conn->real_escape_string($_POST['image_url']);

        $conn->query("INSERT INTO user_plants (user_id, common_name, scientific_name, description, image_url)
                      VALUES ('$user_id','$common_name','$scientific_name','$description','$image_url')");
        $message = "Plant added successfully!";
    } elseif(isset($_POST['edit_plant'])) {
        $id = $_POST['plant_id'];
        $common_name = $conn->real_escape_string($_POST['common_name']);
        $scientific_name = $conn->real_escape_string($_POST['scientific_name']);
        $description = $conn->real_escape_string($_POST['description']);
        $image_url = $conn->real_escape_string($_POST['image_url']);
        $conn->query("UPDATE user_plants SET common_name='$common_name', scientific_name='$scientific_name', description='$description', image_url='$image_url' WHERE id='$id' AND user_id='$user_id'");
        $message = "Plant updated successfully!";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Plant Encyclopedia</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@600&display=swap" rel="stylesheet">
<style>
/* GLOBAL */
* { margin:0; padding:0; box-sizing:border-box; scroll-behavior:smooth; font-family: 'Roboto', sans-serif; }
body { background: linear-gradient(120deg, #d0f0c0, #f0f8ff); color: #333; overflow-x:hidden; }

/* NAVBAR */
#nav {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 150px;
    background: linear-gradient(45deg, #6fb1fc, #4364f7, #1e3c72);
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: white;
    z-index: 1000;
    padding: 0 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: all 0.4s ease;
}
#nav.shrink { top:-50px; height:100px; }
#h { font-size: 60px; font-family: 'Montserrat', sans-serif; text-shadow: 2px 2px 8px rgba(0,0,0,0.3); animation: fadeInDown 1s ease forwards; }

/* RIGHT NAV INFO */
#nav-right { display:flex; align-items:center; gap:15px; font-size:18px; }
#nav-right span { font-weight:600; color:#fff; }
#logout-btn { background:#ff4d4d; padding:10px 18px; border-radius:8px; text-decoration:none; color:white; font-weight:600; transition:0.3s; }
#logout-btn:hover { background:#e60000; transform:scale(1.05); }

/* SEARCH BAR */

#search-bar {
    position: fixed;
    top: 160px; /* initial position */
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255,255,255,0.95);
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    display:flex;
    gap:10px;
    z-index:999;
    max-width:600px;
    width:90%;
    transition: top 0.4s ease; /* important for smooth movement */
}

#search-bar input { flex:1; padding:12px; font-size:18px; border-radius:8px; border:1px solid #ccc; outline:none; transition:all 0.3s ease; }
#search-bar input:focus { border-color:#4caf50; box-shadow:0 0 12px rgba(76,175,80,0.3); }
#search-bar button { background:#4caf50; color:white; border:none; padding:12px 20px; font-size:18px; border-radius:8px; cursor:pointer; transition:all 0.3s ease; }
#search-bar button:hover { background:#45a049; transform:scale(1.05); }

/* SIDEBAR */
#sidebar { position: fixed; top: 150px; left:0; width:170px; height:1000px; background:#f9fff9; padding-top:30px; box-shadow:2px 0 10px rgba(0,0,0,0.1); transition: all 0.3s ease; }
#sidebar a { display:block; padding:15px 25px; color:#2c3e50; font-weight:600; text-decoration:none; position:relative; overflow:hidden; }
#sidebar a::before { content:''; position:absolute; left:0; bottom:0; width:100%; height:0%; background:#4caf50; z-index:-1; transition:height 0.3s ease; }
#sidebar a:hover::before { height:100%; }
#sidebar a:hover { color:white; }

/* MAIN CONTENT */
#main-content { margin-left: 150px; padding: 170px 30px 30px; max-width: 1200px; }

/* PRODUCT LIST */
#product-list { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; padding-bottom:20px; }
#product-list > div { border-radius:12px; border:1px solid #ddd; background:white; overflow:hidden; text-align:center; padding:15px; max-width:250px; transition: transform 0.3s ease, box-shadow 0.3s ease; position:relative; }
#product-list > div:hover { transform:translateY(-10px) scale(1.02); box-shadow:0 15px 25px rgba(0,0,0,0.2); }
#product-list img { width:200px; height:auto; border-radius:10px; margin-bottom:10px; transition:transform 0.3s ease; }
#product-list img:hover { transform:scale(1.05) rotate(-2deg); }
#product-list h3 { font-size:20px; margin-bottom:5px; color:#2c3e50; }
#product-list p { font-size:16px; font-style:italic; color:#555; }

/* CRUD Buttons */
.crud-btn { display:inline-block; padding:8px 12px; margin:5px 2px; border-radius:6px; text-decoration:none; font-weight:600; transition:0.3s; cursor:pointer; }
.edit-btn { background:#4caf50; color:white; }
.edit-btn:hover { background:#45a049; transform:scale(1.05); }
.delete-btn { background:#ff4d4d; color:white; }
.delete-btn:hover { background:#e60000; transform:scale(1.05); }

/* Add Plant Form */
#add-plant-form { background:white; padding:20px; border-radius:12px; margin-bottom:30px; box-shadow:0 5px 15px rgba(0,0,0,0.1); text-align:center; }
#add-plant-form input, #add-plant-form textarea { width:90%; padding:10px; margin:5px 0; border:1px solid #ccc; border-radius:8px; }
#add-plant-form button { padding:10px 20px; border:none; background:#4caf50; color:white; border-radius:8px; cursor:pointer; margin-top:5px; }
#add-plant-form button:hover { background:#45a049; transform:scale(1.05); }

/* Modal */
.modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(0,0,0,0.6); }
.modal-content { background:white; margin:10% auto; padding:20px; border-radius:12px; width:90%; max-width:500px; position:relative; }
.close { position:absolute; top:10px; right:15px; font-size:28px; font-weight:bold; cursor:pointer; color:#333; }

/* MESSAGE */
.message { font-size:16px; color:green; text-align:center; margin-bottom:15px; }

/* ANIMATIONS */
@keyframes fadeInDown { from {opacity:0; transform:translateY(-30px);} to {opacity:1; transform:translateY(0);} }
@keyframes fadeInUp { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }
@keyframes slideDown { from {opacity:0; transform:translateX(-50%) translateY(-50px);} to {opacity:1; transform:translateX(-50%) translateY(0);} }

/* MEDIA QUERIES */
@media(max-width:768px){
    #sidebar { position:relative; width:100%; height:auto; top:0; display:flex; justify-content:center; }
    #sidebar a { display:inline-block; padding:10px 15px; }
    #main-content { margin-left:0; padding-top:320px; }
    #product-list > div img { width:150px; }
}
</style>
</head>
<body>

<!-- NAVBAR -->
<div id="nav">
    <h1 id="h">Plant Encyclopedia</h1>
    <div id="nav-right">
        <span>Welcome, <?php echo htmlspecialchars($_SESSION['user']); ?> 🌿</span>
        <a id="logout-btn" href="logout.php">Logout</a>
    </div>
</div>

<!-- SEARCH BAR -->
<div id="search-bar">
    <input type="text" id="search-input" placeholder="Search by name..." />
    <button id="search-btn">Search</button>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
    <a href="#top">HOME</a>
    <a href="#about">ABOUT</a>
    <a href="#contact">CONTACT</a>
    <a href="javascript:void(0);" id="add-plant-sidebar-btn" onclick="scrollToAddPlant()">+ Add New Plant</a>
</div>

<!-- MAIN CONTENT -->
<div id="main-content">

<!-- Add Plant Form -->


<!-- Product List -->
<div id="product-list">
<?php
$result = $conn->query("SELECT * FROM user_plants WHERE user_id='$user_id' ORDER BY created_at DESC");
while($plant = $result->fetch_assoc()){
    echo "<div data-id='{$plant['id']}'>";
    echo "<h3>{$plant['common_name']}</h3>";
    echo "<p><em>{$plant['scientific_name']}</em></p>";
    echo "<img src='".($plant['image_url'] ?: "https://via.placeholder.com/200x200?text=No+Image")."' alt='{$plant['common_name']}' />";
    echo "<p>{$plant['description']}</p>";
    echo "<button class='crud-btn edit-btn' onclick='openEditModal({$plant['id']},\"{$plant['common_name']}\",\"{$plant['scientific_name']}\",\"{$plant['description']}\",\"{$plant['image_url']}\")'>Edit</button>";
    echo "<a class='crud-btn delete-btn' href='delete_plant.php?id={$plant['id']}' onclick='return confirm(\"Are you sure?\")'>Delete</a>";
    echo "</div>";
}
?>
</div>
<div id="add-plant-form">
    <h3>Add a New Plant</h3>
    <?php if($message != '') { echo "<div class='message'>$message</div>"; } ?>
    <form method="POST">
        <input type="hidden" name="add_plant">
        <input type="text" name="common_name" placeholder="Common Name" required>
        <input type="text" name="scientific_name" placeholder="Scientific Name" required>
        <input type="text" name="image_url" placeholder="Image URL">
        <textarea name="description" placeholder="Description"></textarea>
        <button type="submit">Add Plant</button>
    </form>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h3>Edit Plant</h3>
        <form method="POST">
            <input type="hidden" name="edit_plant" value="1">
            <input type="hidden" name="plant_id" id="edit_id">
            <input type="text" name="common_name" id="edit_common_name" placeholder="Common Name" required>
            <input type="text" name="scientific_name" id="edit_scientific_name" placeholder="Scientific Name" required>
            <input type="text" name="image_url" id="edit_image_url" placeholder="Image URL">
            <textarea name="description" id="edit_description" placeholder="Description"></textarea>
            <button type="submit">Update Plant</button>
        </form>
    </div>
</div>

<section id="about" style="padding:50px 30px; background:linear-gradient(120deg, #f0fff0, #e0f7fa); border-radius:15px; margin-bottom:40px;">
    <h2 style="text-align:center; font-size:36px; color:#2c3e50; margin-bottom:30px;">About Us 🌿</h2>

    <div style="display:flex; flex-wrap:wrap; justify-content:space-around; gap:20px;">

        <!-- Mission -->
        <div style="flex:1 1 250px; background:white; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); text-align:center;">
            <div style="font-size:50px; color:#4caf50;">🌱</div>
            <h3 style="margin:15px 0; color:#2c3e50;">Our Mission</h3>
            <p style="color:#555;">To provide an accessible and comprehensive platform for plant lovers to explore, learn, and share knowledge about plants from all around the world.</p>
        </div>

        <!-- Community -->
        <div style="flex:1 1 250px; background:white; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); text-align:center;">
            <div style="font-size:50px; color:#4caf50;">🤝</div>
            <h3 style="margin:15px 0; color:#2c3e50;">Our Community</h3>
            <p style="color:#555;">A friendly space for gardeners, students, and botanists to connect, share tips, and contribute plant entries to help others.</p>
        </div>

        <!-- Knowledge -->
        <div style="flex:1 1 250px; background:white; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); text-align:center;">
            <div style="font-size:50px; color:#4caf50;">📚</div>
            <h3 style="margin:15px 0; color:#2c3e50;">Knowledge Base</h3>
            <p style="color:#555;">Browse an extensive collection of plants, with scientific names, descriptions, and images, updated to provide accurate and reliable information.</p>
        </div>

    </div>

    <p style="margin-top:30px; text-align:center; font-size:18px; color:#333;">
        Join us on this green journey 🌿 and help nurture a vibrant online plant community, one plant at a time!
    </p>
</section>


<section id="contact" style="padding:50px 30px; background:linear-gradient(120deg, #e0f7fa, #f0fff0); border-radius:15px; margin-bottom:40px;">
    <h2 style="text-align:center; font-size:36px; color:#2c3e50; margin-bottom:30px;">Contact Us 📬</h2>

    <div style="display:flex; flex-wrap:wrap; justify-content:space-around; gap:30px;">

        <!-- Contact Info -->
        <div style="flex:1 1 300px; background:white; padding:25px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
            <h3 style="color:#2c3e50; margin-bottom:15px;">Get in Touch</h3>
            <p style="color:#555;">Have questions, suggestions, or feedback? Reach out to us via the following channels:</p>
            <p style="margin-top:15px; color:#333;"><strong>Email:</strong> info@plantencyclopedia.com</p>
            <p style="color:#333;"><strong>Phone:</strong> +91 123 456 7890</p>
            <p style="color:#333;"><strong>Address:</strong> 123 Green Lane, Botanical City, Earth 🌍</p>
        </div>

        <!-- Contact Form -->
        <div style="flex:1 1 400px; background:white; padding:25px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
            <h3 style="color:#2c3e50; margin-bottom:15px;">Send Us a Message</h3>
            <form id="contact-form">
                <input type="text" name="name" placeholder="Your Name" required 
                    style="width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ccc; outline:none;">
                <input type="email" name="email" placeholder="Your Email" required
                    style="width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ccc; outline:none;">
                <textarea name="message" rows="6" placeholder="Your Message" required
                    style="width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ccc; outline:none;"></textarea>
                <button type="submit" 
                    style="width:100%; padding:12px; background:#4caf50; color:white; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:0.3s;">
                    Send Message
                </button>
            </form>
            <div id="form-message" style="margin-top:10px; font-size:16px; color:green; display:none;"></div>
        </div>

    </div>
</section>

<script>
// Optional: Basic front-end feedback for form submission
document.getElementById('contact-form').addEventListener('submit', function(e){
    e.preventDefault();
    document.getElementById('form-message').textContent = "Thank you! Your message has been sent.";
    document.getElementById('form-message').style.display = "block";
    this.reset();
});
</script>


</div>

<script>
  // Navbar & Search bar move on scroll
window.addEventListener('scroll', () => {
    const nav = document.getElementById('nav');
    const search = document.getElementById('search-bar');

    if(window.scrollY > 50){
        nav.classList.add('shrink');
        search.style.top = '50px'; // move up
    } else {
        nav.classList.remove('shrink');
        search.style.top = '160px'; // original position
    }
});

// Navbar shrink on scroll
window.addEventListener('scroll', () => {
    const nav = document.getElementById('nav');
    if(window.scrollY > 50){
        nav.classList.add('shrink');
    } else {
        nav.classList.remove('shrink');
    }
});

// Perenual API Search
const API_KEY = "sk-zxV868ccf894c8f3e12459";
const searchBtn = document.getElementById('search-btn');
const searchInput = document.getElementById('search-input');
const container = document.getElementById('product-list');

function fetchPlants(query) {
    fetch(`https://perenual.com/api/v2/species-list?key=${API_KEY}&q=${encodeURIComponent(query)}&page=1`)
    .then(res => res.json())
    .then(data => {
        if (!data.data || !data.data.length) { return; }
        data.data.forEach(species => {
            const card = document.createElement('div');
            card.innerHTML = `
                <h3>${species.common_name || 'No Common Name'}</h3>
                <p><em>${species.scientific_name}</em></p>
                <img src="${species.default_image?.original_url || 'https://via.placeholder.com/200x200?text=No+Image'}" alt="${species.common_name || 'Plant Image'}" />
            `;
            container.prepend(card);
        });
    });
}

searchBtn.addEventListener('click', () => {
    const q = searchInput.value.trim();
    if (!q) return alert('Please enter a plant name to search.');
    fetchPlants(q);
});

fetchPlants('rose');

// Edit Modal JS
function openEditModal(id, common, scientific, desc, img){
    document.getElementById('editModal').style.display='block';
    document.getElementById('edit_id').value = id;
    document.getElementById('edit_common_name').value = common;
    document.getElementById('edit_scientific_name').value = scientific;
    document.getElementById('edit_description').value = desc;
    document.getElementById('edit_image_url').value = img;
}
function closeEditModal(){
    document.getElementById('editModal').style.display='none';
}
window.onclick = function(event){
    if(event.target==document.getElementById('editModal')) closeEditModal();
}
</script>

</body>
</html>
